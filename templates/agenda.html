{% extends "base.html" %}
{% block content %}
<section class="section">
  <div class="container">
    <div class="section-header">
      <h1>Agenda cultural</h1>
      <p>Idees d'activitats per completar l'estada.</p>
    </div>
    
    {% set events_by_date = {} %}
    {% for event in agenda %}
      {% set date = event.date %}
      {% if date not in events_by_date %}
        {% set _ = events_by_date.update({date: []}) %}
      {% endif %}
      {% set _ = events_by_date[date].append(event) %}
    {% endfor %}
    
    {% for date in events_by_date.keys()|sort %}
    {% set date_obj = date | replace('-', '') %}
    {% set day_names = {
      '2025-02-13': 'Divendres',
      '2025-02-14': 'Dissabte',
      '2025-02-15': 'Diumenge',
      '2025-02-16': 'Dilluns'
    } %}
    <div class="day-section">
      <div class="day-header">
        <h2 class="day-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16">
            <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
          </svg>
          <span>
            {{ day_names.get(date, '') }}{% if day_names.get(date, '') %}, {% endif %}{{ date }}
          </span>
        </h2>
        <span class="event-count">{{ events_by_date[date]|length }} esdeveniment{% if events_by_date[date]|length != 1 %}s{% endif %}</span>
      </div>
      
      <div class="agenda-grid">
        {% for event in events_by_date[date]|sort(attribute='time_start') %}
        <div class="event-card">
          {% if event.image_url %}
          <div class="event-image">
            <img src="{{ event.image_url }}" alt="{{ event.event_name }}" loading="lazy">
          </div>
          {% endif %}
          
          <div class="event-content">
            <div class="event-header">
              <h3 class="event-title">{{ event.event_name }}</h3>
            </div>
            
            <div class="event-details">
              <div class="event-detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                </svg>
                <span><strong>Horari:</strong> {{ event.time_start }}{% if event.time_end %} - {{ event.time_end }}{% endif %}</span>
              </div>
              
              <div class="event-detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/>
                </svg>
                <span><strong>Lloc:</strong> {{ event.location }}</span>
              </div>
              
              <div class="event-detail-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2.5 1a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h2a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5h-2zm0 3a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1h-5zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm3 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm3 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1zm3 0a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1h-1z"/>
                </svg>
                <span><strong>Preu:</strong> {{ event.price }}</span>
              </div>
            </div>
            
            {% if event.description %}
            <div class="event-description">
              <p>{{ event.description }}</p>
            </div>
            {% endif %}
            
            {% if event.urls %}
            <div class="event-links">
              {% for url in event.urls %}
              {% if url %}
              <a href="{{ url }}" target="_blank" rel="noopener noreferrer" class="event-link">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                  <path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                </svg>
                MÃ©s info
              </a>
              {% endif %}
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
    
  </div>
</section>

<style>
.day-section {
  margin-bottom: 3rem;
}

.day-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 1.5rem;
  padding-bottom: 1rem;
  border-bottom: 3px solid #3498db;
}

.day-title {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  font-size: 1.8rem;
  font-weight: 700;
  color: #2c3e50;
  margin: 0;
}

.day-title svg {
  color: #3498db;
}

.event-count {
  background: #3498db;
  color: white;
  padding: 0.4rem 1rem;
  border-radius: 20px;
  font-size: 0.9rem;
  font-weight: 600;
}

.agenda-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
  gap: 2rem;
}

.event-card {
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s, box-shadow 0.2s;
  display: flex;
  flex-direction: column;
}

.event-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
}

.event-image {
  width: 100%;
  height: 500px;
  overflow: hidden;
  background: #f0f0f0;
}

.event-image img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.event-content {
  padding: 1.5rem;
  flex: 1;
  display: flex;
  flex-direction: column;
}

.event-header {
  margin-bottom: 1rem;
}

.event-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #2c3e50;
  margin: 0;
  line-height: 1.3;
}

.event-details {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1rem;
}

.event-detail-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  font-size: 0.95rem;
  color: #34495e;
}

.event-detail-item svg {
  flex-shrink: 0;
  margin-top: 0.15rem;
  color: #3498db;
}

.event-detail-item strong {
  font-weight: 600;
}

.event-description {
  margin-bottom: 1rem;
  flex: 1;
}

.event-description p {
  font-size: 0.95rem;
  line-height: 1.6;
  color: #555;
  margin: 0;
}

.event-links {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-top: auto;
  padding-top: 1rem;
  border-top: 1px solid #e0e0e0;
}

.event-link {
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  padding: 0.5rem 1rem;
  background: #3498db;
  color: white;
  text-decoration: none;
  border-radius: 6px;
  font-size: 0.9rem;
  font-weight: 500;
  transition: background 0.2s;
}

.event-link:hover {
  background: #2980b9;
}

.event-link svg {
  flex-shrink: 0;
}

@media (max-width: 768px) {
  .day-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }
  
  .day-title {
    font-size: 1.5rem;
  }
  
  .agenda-grid {
    grid-template-columns: 1fr;
    gap: 1.5rem;
  }
  
  .event-title {
    font-size: 1.2rem;
  }
}
</style>
{% endblock %}